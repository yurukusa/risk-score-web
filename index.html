<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Is Your Claude Code Safe? â€” CLAUDE.md Risk Scanner</title>
  <meta name="description" content="Paste your CLAUDE.md and instantly detect dangerous commands, exposed secrets, and risky configurations. Free, client-side only." />
  <!-- OGP / Social -->
  <meta property="og:title" content="Is Your Claude Code Safe? â€” CLAUDE.md Risk Scanner" />
  <meta property="og:description" content="Free tool: paste your CLAUDE.md to scan for dangerous permissions, exposed API keys, and missing safety hooks. 100% client-side, no signup." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://yurukusa.github.io/risk-score-scanner/" />
  <meta property="og:image" content="https://yurukusa.github.io/risk-score-scanner/ogp.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="CLAUDE.md Risk Scanner â€” Free Claude Code Safety Audit" />
  <meta name="twitter:description" content="Paste your CLAUDE.md, get an instant safety score. Detects rm -rf, hardcoded API keys, missing hooks, and more." />
  <meta name="twitter:image" content="https://yurukusa.github.io/risk-score-scanner/ogp.png" />
  <style>
    /* â”€â”€ Reset â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* â”€â”€ Design tokens â”€â”€ */
    :root {
      --bg:          #1a1a2e;
      --bg-surface:  #16213e;
      --bg-card:     #1e2040;
      --bg-deep:     #0f3460;
      --accent:      #e94560;
      --accent-dark: #c0392b;
      --text:        #eaeaea;
      --text-muted:  #8888aa;
      --border:      rgba(255,255,255,.08);
      --safe:        #2ecc71;
      --caution:     #f1c40f;
      --warning-col: #e67e22;
      --critical:    #e74c3c;
      --info-col:    #3498db;
      --radius:      12px;
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* â”€â”€ HERO â”€â”€ */
    header {
      background: linear-gradient(135deg, var(--bg-surface) 0%, var(--bg-deep) 100%);
      border-bottom: 2px solid var(--accent);
      padding: 56px 20px 44px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    header::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse at 15% 60%, rgba(233,69,96,.18) 0%, transparent 55%),
        radial-gradient(ellipse at 85% 20%, rgba(15,52,96,.45) 0%, transparent 55%);
      pointer-events: none;
    }

    .hero-badge {
      display: inline-block;
      background: rgba(233,69,96,.18);
      border: 1px solid rgba(233,69,96,.4);
      color: var(--accent);
      font-size: .72rem;
      font-weight: 700;
      letter-spacing: .12em;
      text-transform: uppercase;
      padding: 4px 16px;
      border-radius: 999px;
      margin-bottom: 20px;
    }

    header h1 {
      font-size: clamp(1.9rem, 5.5vw, 3.4rem);
      font-weight: 800;
      letter-spacing: -.025em;
      line-height: 1.1;
      margin-bottom: 16px;
      position: relative;
    }
    header h1 em { font-style: normal; color: var(--accent); }

    header p.sub {
      font-size: clamp(.9rem, 2.5vw, 1.1rem);
      color: var(--text-muted);
      max-width: 560px;
      margin: 0 auto 32px;
    }

    .hero-pills {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .pill {
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 5px 14px;
      font-size: .78rem;
      color: var(--text-muted);
    }
    .pill strong { color: var(--text); font-weight: 600; }

    /* â”€â”€ LAYOUT â”€â”€ */
    main {
      max-width: 840px;
      margin: 0 auto;
      padding: 36px 18px 72px;
    }

    /* â”€â”€ CARD â”€â”€ */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 22px;
    }
    .card-label {
      font-size: .68rem;
      font-weight: 700;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    /* â”€â”€ TEXTAREA â”€â”€ */
    textarea {
      width: 100%;
      min-height: 220px;
      background: rgba(0,0,0,.4);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 8px;
      color: var(--text);
      font-family: 'Consolas', 'Courier New', monospace;
      font-size: .85rem;
      line-height: 1.7;
      padding: 14px 16px;
      resize: vertical;
      outline: none;
      transition: border-color .2s, box-shadow .2s;
    }
    textarea::placeholder { color: var(--text-muted); opacity: .7; }
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(233,69,96,.15);
    }

    .scan-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 14px;
      flex-wrap: wrap;
    }
    .btn-scan {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: .95rem;
      font-weight: 700;
      padding: 11px 28px;
      cursor: pointer;
      transition: transform .14s, box-shadow .14s;
    }
    .btn-scan:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 22px rgba(233,69,96,.5);
    }
    .btn-scan:active { transform: scale(.97); }
    .btn-sample {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      border-radius: 8px;
      font-size: .83rem;
      padding: 9px 16px;
      cursor: pointer;
      transition: border-color .15s, color .15s;
    }
    .btn-sample:hover { border-color: rgba(255,255,255,.22); color: var(--text); }

    .hint {
      font-size: .75rem;
      color: var(--text-muted);
      margin-left: auto;
    }

    /* â”€â”€ SCORE â”€â”€ */
    #result-section { display: none; }

    .score-wrap {
      display: flex;
      align-items: center;
      gap: 28px;
      flex-wrap: wrap;
    }

    /* Ring */
    .ring-outer { position: relative; width: 130px; height: 130px; flex-shrink: 0; }
    .ring-svg { width: 130px; height: 130px; transform: rotate(-90deg); }
    .ring-bg { fill: none; stroke: rgba(255,255,255,.07); stroke-width: 11; }
    .ring-fg {
      fill: none;
      stroke-width: 11;
      stroke-linecap: round;
      /* circumference for r=55: 2Ï€Ã—55 â‰ˆ 345.6 */
      stroke-dasharray: 345.6;
      stroke-dashoffset: 345.6;
      transition: stroke-dashoffset 1.1s cubic-bezier(.4,0,.2,1), stroke .3s;
    }
    .ring-center {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .ring-num {
      font-size: 2.2rem;
      font-weight: 800;
      line-height: 1;
    }
    .ring-of {
      font-size: .65rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    .score-meta { flex: 1; min-width: 180px; }
    .score-band {
      font-size: 1.35rem;
      font-weight: 800;
      margin-bottom: 6px;
    }
    .score-desc-text { font-size: .88rem; color: var(--text-muted); line-height: 1.5; }
    .score-bar-wrap {
      height: 6px;
      background: rgba(255,255,255,.07);
      border-radius: 999px;
      margin-top: 12px;
      overflow: hidden;
    }
    .score-bar-fill {
      height: 100%;
      border-radius: 999px;
      width: 0%;
      transition: width 1.1s cubic-bezier(.4,0,.2,1);
    }

    /* â”€â”€ FINDINGS â”€â”€ */
    .findings-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 9px;
    }
    .finding {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      background: rgba(0,0,0,.28);
      border-radius: 8px;
      padding: 12px 14px;
      border-left: 3px solid transparent;
    }
    .finding.critical { border-color: var(--critical); }
    .finding.warning  { border-color: var(--warning-col); }
    .finding.info     { border-color: var(--info-col); }

    .finding-icon { font-size: 1.05rem; flex-shrink: 0; margin-top: 1px; }
    .finding-body { flex: 1; min-width: 0; }
    .finding-title { font-size: .87rem; font-weight: 700; margin-bottom: 3px; }
    .finding-detail { font-size: .78rem; color: var(--text-muted); line-height: 1.5; }
    .finding-fix {
      margin-top: 6px;
      font-size: .76rem;
      color: var(--safe);
      padding: 5px 8px;
      background: rgba(46,204,113,.07);
      border-left: 2px solid rgba(46,204,113,.4);
      border-radius: 0 4px 4px 0;
    }
    .finding-pts {
      font-size: .68rem;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 999px;
      white-space: nowrap;
      flex-shrink: 0;
      align-self: flex-start;
    }
    .pts-critical { background: rgba(231,76,60,.2);  color: var(--critical); }
    .pts-warning  { background: rgba(230,126,34,.2); color: var(--warning-col); }
    .pts-info     { background: rgba(52,152,219,.18); color: #5dade2; }

    /* all-clear */
    .all-clear {
      display: flex;
      gap: 14px;
      align-items: center;
      background: rgba(46,204,113,.08);
      border: 1px solid rgba(46,204,113,.25);
      border-radius: 10px;
      padding: 16px 18px;
    }
    .all-clear-icon { font-size: 1.8rem; }
    .all-clear-title { font-weight: 700; color: var(--safe); }
    .all-clear-sub   { font-size: .82rem; color: var(--text-muted); margin-top: 2px; }

    /* â”€â”€ IMPROVEMENTS â”€â”€ */
    .improve-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .improve-item {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      font-size: .85rem;
      line-height: 1.55;
    }
    .improve-arrow {
      color: var(--accent);
      font-weight: 700;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* â”€â”€ CTA â”€â”€ */
    .cta-card {
      background: linear-gradient(135deg, #1a1040 0%, #241255 100%);
      border: 1px solid rgba(233,69,96,.35);
      border-radius: var(--radius);
      padding: 32px 24px;
      text-align: center;
      position: relative;
      overflow: hidden;
      margin-bottom: 22px;
    }
    .cta-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: 50%;
      transform: translateX(-50%);
      width: 420px;
      height: 240px;
      background: radial-gradient(ellipse, rgba(233,69,96,.12) 0%, transparent 70%);
      pointer-events: none;
    }
    .cta-eye {
      font-size: .7rem;
      font-weight: 700;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 10px;
    }
    .cta-card h2 {
      font-size: clamp(1.15rem, 3vw, 1.6rem);
      font-weight: 800;
      margin-bottom: 10px;
    }
    .cta-card p {
      font-size: .88rem;
      color: var(--text-muted);
      max-width: 460px;
      margin: 0 auto 20px;
      line-height: 1.6;
    }
    .cta-feats {
      display: flex;
      justify-content: center;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 22px;
    }
    .cta-feat {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: .78rem;
      color: var(--text-muted);
    }
    .cta-feat .ok { color: var(--safe); font-weight: 700; }
    .btn-cta {
      display: inline-block;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      color: #fff;
      text-decoration: none;
      font-size: 1rem;
      font-weight: 800;
      padding: 14px 36px;
      border-radius: 10px;
      box-shadow: 0 4px 22px rgba(233,69,96,.4);
      transition: transform .14s, box-shadow .14s;
    }
    .btn-cta:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 32px rgba(233,69,96,.6);
    }
    .btn-cta-sub {
      display: block;
      font-size: .72rem;
      font-weight: 400;
      opacity: .82;
      margin-top: 3px;
    }

    /* â”€â”€ FOOTER â”€â”€ */
    footer {
      text-align: center;
      padding: 20px;
      font-size: .76rem;
      color: var(--text-muted);
      border-top: 1px solid var(--border);
    }

    /* â”€â”€ RESPONSIVE â”€â”€ */
    @media (max-width: 520px) {
      .score-wrap { flex-direction: column; align-items: flex-start; }
      .cta-feats  { flex-direction: column; align-items: center; }
      .hint       { display: none; }
    }

    /* â”€â”€ ANIMATIONS â”€â”€ */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(14px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .fade-up   { animation: fadeUp .4s ease both; }
    .delay-1   { animation-delay: .07s; }
    .delay-2   { animation-delay: .14s; }
    .delay-3   { animation-delay: .21s; }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• HERO â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header>
  <div class="hero-badge">Free â€” No Signup â€” 100% Client-Side</div>
  <h1>Is Your <em>Claude Code</em> Safe?</h1>
  <p class="sub">Paste your <code>CLAUDE.md</code> to instantly scan for dangerous commands, exposed secrets, and risky configurations.</p>
  <div class="hero-pills">
    <span class="pill"><strong>8</strong> risk patterns</span>
    <span class="pill"><strong>3</strong> severity levels</span>
    <span class="pill"><strong>0</strong> data sent to server</span>
    <span class="pill">Ctrl+Enter to scan</span>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main>

  <!-- Input -->
  <div class="card">
    <div class="card-label">Step 1 â€” Paste Your CLAUDE.md</div>
    <textarea id="txt"
      placeholder="# My CLAUDE.md&#10;&#10;Paste the full contents of your Claude Code instruction file hereâ€¦&#10;(or click &quot;Load risky sample&quot; to see the scanner in action)"
      spellcheck="false"
    ></textarea>
    <div class="scan-row">
      <button class="btn-scan" onclick="runScan()">Scan Now &rarr;</button>
      <button class="btn-sample" onclick="loadSample()">Load risky sample</button>
      <span class="hint" id="hint">Ctrl+Enter to scan</span>
    </div>
  </div>

  <!-- Static CTA (shown before first scan) -->
  <div class="cta-card" id="static-cta">
    <div class="cta-eye">More than a scanner</div>
    <h2>Harden Your Claude Code Setup</h2>
    <p>The scanner catches obvious risks. The Ops Kit shows you how to fix them with ready-to-use hook templates, hardening scripts, and a 25-item checklist.</p>
    <a href="https://yurukusa.gumroad.com/l/cc-codex-ops-kit" class="btn-cta" target="_blank" rel="noopener">
      Get Claude Code Ops Kit
      <span class="btn-cta-sub">$9.99 on Gumroad Â· instant download</span>
    </a>
  </div>

  <!-- â”€â”€â”€ RESULT SECTION â”€â”€â”€ -->
  <div id="result-section">

    <!-- Score -->
    <div class="card fade-up" id="score-card">
      <div class="card-label">Risk Score</div>
      <div class="score-wrap">
        <div class="ring-outer">
          <svg class="ring-svg" viewBox="0 0 120 120">
            <circle class="ring-bg" cx="60" cy="60" r="55"/>
            <circle class="ring-fg" id="ring-fg" cx="60" cy="60" r="55"/>
          </svg>
          <div class="ring-center">
            <span class="ring-num" id="ring-num">0</span>
            <span class="ring-of">/ 100</span>
          </div>
        </div>
        <div class="score-meta">
          <div class="score-band" id="score-band">â€”</div>
          <div class="score-desc-text" id="score-desc">Scanningâ€¦</div>
          <div class="score-bar-wrap">
            <div class="score-bar-fill" id="score-bar"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Findings -->
    <div class="card fade-up delay-1" id="findings-card">
      <div class="card-label">Findings</div>
      <ul class="findings-list" id="findings-list"></ul>
    </div>

    <!-- Improvements -->
    <div class="card fade-up delay-2" id="improve-card">
      <div class="card-label">Improvement Suggestions</div>
      <ul class="improve-list" id="improve-list"></ul>
    </div>

    <!-- Result CTA -->
    <div class="cta-card fade-up delay-3">
      <div class="cta-eye">Want a deeper audit?</div>
      <h2>Get the Full Claude Code Ops Kit</h2>
      <p>Battle-tested CLAUDE.md template, PreToolUse safety hooks, secrets injection guide, and a step-by-step hardening checklist.</p>
      <div class="cta-feats">
        <span class="cta-feat"><span class="ok">&#10003;</span> Safe CLAUDE.md template</span>
        <span class="cta-feat"><span class="ok">&#10003;</span> PreToolUse hook scripts</span>
        <span class="cta-feat"><span class="ok">&#10003;</span> Dangerous-command blocklist</span>
        <span class="cta-feat"><span class="ok">&#10003;</span> 25-item hardening checklist</span>
      </div>
      <a href="https://yurukusa.gumroad.com/l/cc-codex-ops-kit" class="btn-cta" target="_blank" rel="noopener">
        Get Detailed Report
        <span class="btn-cta-sub">Claude Code Ops Kit â€” $9.99</span>
      </a>
    </div>

    <div style="text-align:center;margin-top:8px">
      <button class="btn-sample" onclick="resetScan()">&larr; Scan a different file</button>
    </div>

  </div><!-- /result-section -->

</main>

<footer>
  Claude Code Risk Scanner &mdash; free, open-source, runs entirely in your browser. No data is sent anywhere.
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
'use strict';

/* â”€â”€ Rule table â”€â”€ */
const RULES = [
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CRITICAL  (âˆ’20 each) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    id: 'rm_rf',
    sev: 'critical',
    pts: 20,
    icon: 'â›”',
    test: t => /\brm\s+-[a-z]*r[a-z]*f\b|\brm\s+--recursive/i.test(t),
    title: 'Destructive file deletion (`rm -rf`) detected',
    detail: '`rm -rf` can irreversibly wipe files or entire directories. Allowing AI agents to run this autonomously is extremely dangerous.',
    fix: 'Add a PreToolUse hook denying bash commands matching /rm\\s+-[a-z]*r[a-z]*f/. Require explicit approval for any recursive deletion.',
  },
  {
    id: 'git_force',
    sev: 'critical',
    pts: 20,
    icon: 'â›”',
    test: t => /git\s+push\s+--force|git\s+push\s+-f\b|git\s+reset\s+--hard|git\s+clean\s+-[a-z]*f/i.test(t),
    title: 'Irreversible Git operation permitted (`--force` / `--hard`)',
    detail: '`git push --force`, `git reset --hard`, and `git clean -fd` can permanently destroy commit history and local work.',
    fix: 'Block these via a PreToolUse hook or deny-list in your hooks config. If force-push is ever needed, gate it behind explicit human approval.',
  },
  {
    id: 'secrets',
    sev: 'critical',
    pts: 20,
    icon: 'â›”',
    test: t => /\b(API[_-]?KEY|SECRET[_-]?KEY|ACCESS[_-]?TOKEN|AUTH[_-]?TOKEN|PASSWORD|PRIVATE[_-]?KEY)\s*[:=]\s*\S{8,}/i.test(t)
            || /-----BEGIN\s+(?:RSA|EC|OPENSSH|DSA)\s+PRIVATE\s+KEY-----/.test(t)
            || /sk-[A-Za-z0-9]{20,}/.test(t),
    title: 'Hardcoded secret or API key found',
    detail: 'Credentials embedded directly in CLAUDE.md are visible to anyone who reads the file and may be logged by the AI model.',
    fix: 'Move all secrets to environment variables or a secrets manager. Reference them by name only (e.g. `$GUMROAD_API_KEY`).',
  },
  {
    id: 'sudo_unlimited',
    sev: 'critical',
    pts: 20,
    icon: 'â›”',
    test: t => /\bsudo\b/i.test(t) && !/deny.*sudo|block.*sudo|no.*sudo|ç¦æ­¢.*sudo/i.test(t),
    title: 'Unrestricted `sudo` access allowed',
    detail: 'Allowing `sudo` without restriction gives the AI elevated system privileges that can affect the entire machine.',
    fix: 'Either deny `sudo` outright in a hook, or maintain a strict allowlist of the exact commands that need it.',
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ WARNING  (âˆ’10 each) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    id: 'git_add_all',
    sev: 'warning',
    pts: 10,
    icon: 'âš ï¸',
    test: t => /\bgit\s+add\s+(-A|\.)\b/i.test(t),
    title: '`git add -A` / `git add .` can stage sensitive files',
    detail: 'Staging everything risks accidentally committing `.env` files, credentials, or large binaries to the repository.',
    fix: 'Use explicit paths (`git add src/`) or rely on a well-maintained `.gitignore`. Add a pre-commit secret-scanning hook.',
  },
  {
    id: 'auto_post',
    sev: 'warning',
    pts: 10,
    icon: 'âš ï¸',
    test: t => /curl\s+.*-[A-Z]*X\s+POST|fetch\s*\([^)]*,\s*\{[^}]*method\s*:\s*["']POST["']/i.test(t),
    title: 'Automated POST to external URL',
    detail: 'Instructions that auto-POST data to external endpoints could exfiltrate content without your awareness.',
    fix: 'Require explicit human confirmation before any data is sent to third-party endpoints. Log all outbound requests.',
  },
  {
    id: 'no_verify',
    sev: 'warning',
    pts: 10,
    icon: 'âš ï¸',
    test: t => /--no-verify|--skip-hooks|--no-gpg-sign/i.test(t),
    title: 'Hook bypass flag (`--no-verify`) detected',
    detail: '`--no-verify` disables pre-commit safety hooks that would otherwise catch issues before they reach the repository.',
    fix: 'Remove bypass flags from standard workflows. Fix the root cause of failing hooks rather than silencing them.',
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ INFO  (âˆ’5 each) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    id: 'large_file',
    sev: 'info',
    pts: 5,
    icon: 'â„¹ï¸',
    _size: true,
    sizeLimit: 5120,
    title: 'CLAUDE.md exceeds 5 KB â€” large context risk',
    detail: 'Very large instruction files consume more tokens per request, increase cost, and can cause critical rules to be ignored due to attention limits.',
    fix: 'Split into focused sub-files. Keep the root CLAUDE.md under 5 KB and reference project-specific files via `@import` or equivalent.',
  },
  {
    id: 'auto_commit',
    sev: 'info',
    pts: 5,
    icon: 'â„¹ï¸',
    test: t => /\bgit\s+commit\b/i.test(t) && !/approval|review|confirm|æ‰¿èª|ç¢ºèª/i.test(t),
    title: 'Automatic git commit without approval gate',
    detail: 'Committing autonomously means code errors are immediately persisted to history with no review step.',
    fix: 'Gate automated commits behind a passing test suite (`npm test` or `pytest`), and consider a lightweight approval step.',
  },
  {
    id: 'env_inline',
    sev: 'info',
    pts: 5,
    icon: 'â„¹ï¸',
    test: t => /export\s+[A-Z_]{4,}\s*=\s*\S+/g.test(t),
    title: 'Environment variable value assigned inline',
    detail: 'Inline env-var assignments may expose values if the file is shared or accidentally committed.',
    fix: 'Use `export VAR_NAME` without a value in CLAUDE.md. Document where the real value is stored (vault/`.env`), never the value itself.',
  },
];

/* â”€â”€ General improvement tips (always appended) â”€â”€ */
const GENERAL_TIPS = [
  'Add an explicit deny-list section listing every command the AI must never run autonomously.',
  'Enable a PreToolUse hook that intercepts bash commands and blocks high-risk patterns.',
  'Rotate any API keys that have appeared in your CLAUDE.md, even briefly.',
  'Keep CLAUDE.md under 5 KB â€” split into project-specific sub-files to reduce token waste.',
  'Add a `.gitignore` entry for `.env` and secrets files, and verify it with `git status` before every commit.',
];

/* â”€â”€ Risky sample content â”€â”€ */
const SAMPLE = `# CLAUDE.md â€” Demo Config (Intentionally Risky)

## Language
Always respond in English.

## Dangerous Commands (DO NOT USE IN PROD)
- bash: allow rm -rf ./tmp ./build ./node_modules
- bash: allow git reset --hard HEAD~1
- bash: allow git push --force origin main
- bash: allow git clean -fd
- bash: allow sudo apt-get install -y

## API Keys
OPENAI_API_KEY=sk-abc123XYZsomethingLongValue456789
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.abc.xyz

## Git workflow
Always run: git add -A && git commit -m "auto: AI commit" --no-verify

## Deployment
curl -X POST https://api.example.com/deploy -d @payload.json

## Notes
- No PreToolUse hook configured
- bypassPermissions intentionally omitted here but --no-verify is present
`;

/* â”€â”€ Helpers â”€â”€ */
function scoreToColor(s) {
  if (s >= 80) return 'var(--safe)';
  if (s >= 60) return 'var(--caution)';
  if (s >= 40) return 'var(--warning-col)';
  return 'var(--critical)';
}
function scoreToLabel(s) {
  if (s >= 80) return { band: 'âœ… SAFE',          desc: 'Your CLAUDE.md looks clean. No high-severity patterns detected.' };
  if (s >= 60) return { band: 'âš ï¸ CAUTION',        desc: 'Some risky patterns found. Review the warnings and apply the fixes.' };
  if (s >= 40) return { band: 'ðŸ”¶ WARNING',        desc: 'Multiple risk factors detected. Address issues before using with autonomous agents.' };
  return               { band: 'ðŸ›‘ CRITICAL RISK', desc: 'Serious security risks found. Do not run autonomous AI agents with this configuration.' };
}

function animateNum(el, target, ms) {
  const start = performance.now();
  (function tick(now) {
    const t = Math.min((now - start) / ms, 1);
    const e = 1 - Math.pow(1 - t, 3); // ease-out cubic
    el.textContent = Math.round(target * e);
    if (t < 1) requestAnimationFrame(tick);
  })(start);
}

function esc(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* â”€â”€ Main scan â”€â”€ */
function runScan() {
  const text = document.getElementById('txt').value.trim();
  if (!text) { document.getElementById('txt').focus(); return; }

  const byteLen = new Blob([text]).size;
  const hits = [];

  for (const rule of RULES) {
    let triggered = false;
    if (rule._size) {
      triggered = byteLen > rule.sizeLimit;
    } else {
      triggered = rule.test(text);
    }
    if (triggered) hits.push(rule);
  }

  // sort: critical â†’ warning â†’ info
  const order = { critical: 0, warning: 1, info: 2 };
  hits.sort((a, b) => order[a.sev] - order[b.sev]);

  const deducted = hits.reduce((acc, r) => acc + r.pts, 0);
  const score = Math.max(0, 100 - deducted);

  renderResults(score, hits);
}

function renderResults(score, hits) {
  // Toggle sections
  document.getElementById('static-cta').style.display = 'none';
  const sec = document.getElementById('result-section');
  sec.style.display = 'block';

  // â”€â”€ Score ring & counter â”€â”€
  const color = scoreToColor(score);
  const lbl   = scoreToLabel(score);
  const circumference = 345.6; // 2Ï€Ã—55

  const ring = document.getElementById('ring-fg');
  ring.style.stroke = color;
  ring.style.strokeDashoffset = circumference; // reset first
  requestAnimationFrame(() => requestAnimationFrame(() => {
    ring.style.strokeDashoffset = circumference * (1 - score / 100);
  }));

  const numEl = document.getElementById('ring-num');
  numEl.style.color = color;
  animateNum(numEl, score, 1100);

  document.getElementById('score-band').textContent = lbl.band;
  document.getElementById('score-band').style.color = color;
  document.getElementById('score-desc').textContent = lbl.desc;

  const bar = document.getElementById('score-bar');
  bar.style.background = color;
  setTimeout(() => { bar.style.width = score + '%'; }, 60);

  // â”€â”€ Findings â”€â”€
  const findEl = document.getElementById('findings-list');
  findEl.innerHTML = '';

  if (hits.length === 0) {
    findEl.innerHTML = `
      <li>
        <div class="all-clear">
          <div class="all-clear-icon">&#10003;&#65039;</div>
          <div>
            <div class="all-clear-title">No issues detected</div>
            <div class="all-clear-sub">Your CLAUDE.md is clean for the patterns we check. Review the tips below to harden it further.</div>
          </div>
        </div>
      </li>`;
  } else {
    for (const h of hits) {
      const sevCls = h.sev;
      const ptsCls = `pts-${h.sev}`;
      const ptsLabel = `âˆ’${h.pts} pts`;
      const li = document.createElement('li');
      li.className = `finding ${sevCls}`;
      li.innerHTML = `
        <div class="finding-icon">${h.icon}</div>
        <div class="finding-body">
          <div class="finding-title">${esc(h.title)}</div>
          <div class="finding-detail">${esc(h.detail)}</div>
          <div class="finding-fix">&#128161; Fix: ${esc(h.fix)}</div>
        </div>
        <span class="finding-pts ${ptsCls}">${ptsLabel}</span>`;
      findEl.appendChild(li);
    }
  }

  // â”€â”€ Improvements â”€â”€
  const usedFixes = new Set(hits.map(h => h.fix));
  const extraTips = GENERAL_TIPS.filter(t => ![...usedFixes].includes(t));
  const allTips = [
    ...hits.map(h => h.fix),
    ...extraTips.slice(0, Math.max(3, 5 - hits.length)),
  ];

  const impEl = document.getElementById('improve-list');
  impEl.innerHTML = '';
  for (const tip of allTips) {
    const li = document.createElement('li');
    li.className = 'improve-item';
    li.innerHTML = `<span class="improve-arrow">&rarr;</span><span>${esc(tip)}</span>`;
    impEl.appendChild(li);
  }

  // Scroll
  setTimeout(() => {
    document.getElementById('score-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 80);
}

function loadSample() {
  document.getElementById('txt').value = SAMPLE;
  document.getElementById('txt').focus();
}

function resetScan() {
  document.getElementById('result-section').style.display = 'none';
  document.getElementById('static-cta').style.display = 'block';
  document.getElementById('txt').value = '';
  document.getElementById('txt').focus();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* Keyboard shortcut */
document.getElementById('txt').addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); runScan(); }
});
</script>
</body>
</html>
